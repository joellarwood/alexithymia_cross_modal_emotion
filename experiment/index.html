<!DOCTYPE html>
<html>

<head>
  <title>Music Selector</title>
  <script src="jspsych-6.1.0/jspsych.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
  <script src="conditions.js"></script>
  <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css">
  <!--  <script src="/assets/javascripts/jatos.js"></script> -->
  </link>
</head>

<body></body>
<script>
  /* create timeline */
  var timeline = [];

  /* assign subject ID */
  var subject_id = jsPsych.randomization.randomID(15);
  jsPsych.data.addProperties({
    subject: subject_id
  });

  /*
  var check_consent = function (elem) {
    if (document.getElementById('consent_checkbox').checked) {
      return true;
    } else {
      alert(
        "If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'"
        );
      return false;
    }
    return false;
  };


  var consent = {
    type: 'external-html',
    url: 'static/consent.html',
    cont_btn: "start",
    check_fn: check_consent
  };
  */

  //timeline.push(consent)

  // declare instructions

  var instructions = {
    type: 'instructions',
    pages: [
      "Welcome to the Experiment. Please Click next to begin",
      "<p>In this study you will listen to a number of short musical clips. </p>",
      "<p>There are four parts to this experiment, three which involve listening to music and one that is a short survey</p>",
      "<p>In the first three parts of the experiment you will listen to a one second song and then be presented with either another song, an image, or a word<p>",
      "Your task is to say whether the emotion in the song you first heard matches the emotion in the stimulus that follows<p>",
      "On the next page a song will play automatically. </p><p>Please adjust the volume so that the song is at a comfortable volume <br>",
      "Adjust the volume on your computer so that it is at a comfortable level. </p>" +
      "<p><audio autoplay src='audio/test_audio_short.mp3'></audio></p>" +
      "Press next when the audio is at a comfortable level",
      "<p> The experiment will begin when you press next. </p><p>Remember that you are rating emotion or feeling you think the song is trying to express"
    ],
    show_clickable_nav: true
  }


  /* define audio */
  var all_songs = [
    "audio/5_Get_Lucky.mp3",
    "audio/16_Restless.mp3",
    "audio/7_Here_Today.mp3",
    "audio/2_Inside.mp3",
    "audio/13_Motown_Junk.mp3",
    "audio/2_Incomplete.mp3",
    "audio/21_Skank_Down.mp3",
    "audio/26_Make_Light.mp3",
    "audio/1_Be_Happy.mp3",
    "audio/5_Valerie.mp3",
    "audio/2_Loves_Requiem.mp3",
    "audio/8_Fire_And_Rain__(LP_Version).mp3",
    "audio/3_Old_Blacktop.mp3",
    "audio/12_Skinny_Love.mp3"
  ]

  /* define images */
  var all_images = [
    "BF05ANS.JPG",
    "BF34ANS.JPG",
    "BF34HAS.JPG",
    "BF34SAS.JPG",
    "BM08ANS.JPG",
    "BM08HAS.JPG",
    "BF08SAS.JPG"
  ]

  // define durations 
  stimulus_duration = 1000
  target_duration = 2500
  isi_duration = 200
  iti_duration = 1500

  // create iti 
  var iti = {
    type: 'html-keyboard-response',
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: jsPsych.NO_KEYS,
    trial_duration: iti_duration,
    data: {
      test_part: "iti"
    }
  }

  // create cue condition

  var cue = {
    type: "audio-keyboard-response",
    stimulus: jsPsych.timelineVariable('cue'),
    trial_duration: stimulus_duration,
    choices: jsPsych.NO_KEYS,
    data: {
      task: 'cue',
      cue_song: jsPsych.timelineVariable('cue'),
      cue_emotion: jsPsych.timelineVariable('cue_emotion')
    }
  }

  // create isi 

  var isi = {
    type: 'html-keyboard-response',
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: jsPsych.NO_KEYS,
    trial_duration: isi_duration,
    data: {
      test_part: "isi"
    }
  }



  /* music block instructions */

  var music_instructions = {
    type: "html-keyboard-response",
    stimulus: "<p>In this part of the experiment you will hear a short musical clip and then shortly after hear another musical clip</p>" +
      "<p>If the emotion in the two songs match the press the left arrow key (<-)</p>" +
      "<p>If the emotion in the two songs does not match then press the right arrow key (->)" +
      "<p>Please be as quick and accurate as possible</p>" +
      "<p>Press the space bar to begin</p>",
    choices: ['spacebar'],
    data: {
      test_part: "instruction"
    }
  };


  // music practice trial






  /* Create music match task */

  var music_target = {
    type: "audio-keyboard-response",
    stimulus: jsPsych.timelineVariable('target_song'),
    trial_duration: target_duration,
    choices: ("37", "39"),
    data: {
      task: 'target',
      target_stimulus: jsPsych.timelineVariable('target_song'),
      target_emotion: jsPsych.timelineVariable('target_emotion'),
      condition: jsPsych.timelineVariable('condition')
    }
  }

  var music_trials = {
    timeline: [iti, cue, isi, music_target],
    timeline_variables: conditions,
    randomize_order: true,
    data: {
      trial: 'true'
    }
  }

  var music_block = {
    timeline: [music_instructions, music_trials],
    data: {
      block: 'music'
    }
  }



  // create face match task 

  // face instructions

  var face_instructions = {
    type: "html-keyboard-response",
    stimulus: "<p>In this part of the experiment you will hear a short musical clip and then shortly after view a face</p>" +
      "<p>If the emotion in the song and the face match the press the left arrow key (<-)</p>" +
      "<p>If the emotion in the song and the face do not match then press the right arrow key (->)" +
      "<p>Please be as quick and accurate as possible</p>" +
      "<p>Press the space bar to begin</p>",
    choices: ['spacebar'],
    data: {
      test_part: "instruction"
    }
  };


  var face_target = {
    type: "image-keyboard-reponse",
    stimulus: jsPsych.timelineVariable('target_face'),
    stimulus_duration: stimulus_duration,
    trial_duration: target_duration,
    choices: ('37', '39'),
    data: {
      task: 'target',
      target_stimulus: jsPsych.timelineVariable('target_face'),
      target_emotion: jsPsych.timelineVariable('target_emotion'),
      condition: jsPsych.timelineVariable('condition')
    }
  }


  //define face trials 

  var face_trials = {
    timeline: [iti, cue, isi, face_target],
    timeline_variables: conditions,
    randomize_order: true,
    data: {
      trial: 'true'
    }
  }



  // create face block

var face_block = {
  timeline: [face_instructions, face_trials],
  data: {
    block: 'face'
  }
}


  // create word match task 

  var word_instructions = {
    type: "html-keyboard-response",
    stimulus: "<p>In this part of the experiment you will hear a short musical clip and then shortly be shown a word</p>" +
      "<p>If the emotion in the song and the word match the press the left arrow key (<-)</p>" +
      "<p>If the emotion in the song and the word do not match then press the right arrow key (->)" +
      "<p>Please be as quick and accurate as possible</p>" +
      "<p>Press the space bar to begin</p>",
    choices: ['spacebar'],
    data: {
      test_part: "instruction"
    }
  };

  var word_target = {
    type: 'html-keyboard-response',
    stimulus: function () {
      return `<p style="font-size: 48px; font-family: monospace;">${jsPsych.timelineVariable('target_word', true).toUpperCase()}</p>`
    },
    stimulus_duration: stimulus_duration,
    trial_duration: target_duration,
    choices: ('37', '39'),
    data: {
      task: 'target',
      target_stimulus: jsPsych.timelineVariable('target_word'),
      target_emotion: jsPsych.timelineVariable('target_emotion'),
      condition: jsPsych.timelineVariable('condition')
    }
  }

  // define word trials 

  var word_trials = {
    timeline: [iti, cue, isi, word_target],
    timeline_variables: conditions,
    randomize_order: true,
    data: {
      trial: 'true'
    }
  }

var word_block = {
  timeline: [word_instructions, word_trials],
  data: {
    block: 'word'
  }
}

//randomise the trial blocks
var randomise_blocks = {
  timeline: jsPsych.randomization.shuffle([music_block, face_block, word_block]),
  repetitions: 1
}



  /*  var thanks = {
      type: 'html-keyboard-response',
      stimulus: "Thankyou! <p>If you press the spacebar and download the file it would be great if you could send it to me :)!",
      data: {test_part: "thanks"}
    };
    timeline.push(thanks); */



  /* start the experiment */
  //  jatos.onLoad(function(){
  jsPsych.init({
    preload_audio: all_songs,
    //    on_finish: function() { /* Do I need on finish or on_close here? */
    //      var resultJson = jsPsych.data.get().json();
    //      jatos.submitResultData(resultJson, jatos.startNextComponent);
    //    },
    timeline: [instructions, randomise_blocks],
    use_webaudio: false,
  });
  //});
</script>

</html>